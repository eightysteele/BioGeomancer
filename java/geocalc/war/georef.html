<!DOCTYPE html> 
<html> 
<head> 
<meta name="viewport" content="initial-scale=1.0, user-scalable=no"/> 
<meta http-equiv="content-type" content="text/html; charset=UTF-8"/> 
<title>Georeference - Feature Only</title> 
<link href="http://code.google.com/apis/maps/documentation/javascript/examples/standard.css" rel="stylesheet" type="text/css" /> 
<link href='http://fonts.googleapis.com/css?family=Gruppo' rel='stylesheet' type='text/css'>
<style>
#bg {
  font-family: 'Gruppo', serif;
  font-size: 26px;
  font-style: normal;
  font-weight: 400;
  text-shadow: none;
  text-decoration: none;
  text-transform: none;
  letter-spacing: 0em;
  word-spacing: 0em;
  color: grey;
  line-height: 1.2;
}

#button {
    position:fixed;
    top:31px;
}

</style>
<script src="http://maps.google.com/maps/api/js?sensor=false"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.min.js"></script> 
</head> 
<body style="font: 75% Lucida Grande, Trebuchet MS"> 
    <div id='bg'>BioGeomancer2.0</div>
    <input id="location" type="search" style="width: 300px;"> 
    <input id="button" type="button" value="Georeference">
    <p> 
    <div id="map_canvas" style="height:60%"></div>
    <p>
    Raw JSON results:<BR>
    <div id="json_results"></div>
<script><!-- 

	$ = (function () {
  		var $ = function(id) {
    		return document.getElementById(id);
  		}
  		return $;
	}());
	
	var app = app || {};
    
	app.handleOnClick = function(evt) {
    	var address = $('location').value;
    	if (address == '') {
    	  address = $('location').getAttribute('placeholder');
    	}
 		app.geocoder.geocode( { 'address': address}, function(results, status) {
    		if (status == google.maps.GeocoderStatus.OK) {
    		  	var position = results[0].geometry.location;
      			var marker = new google.maps.Marker({
          			map: app.map, 
          			position: position
      			});
      			jQuery.ajax({
      			  url: '/geocalc?type=pno&extent=3000&ll='+position.lat()+','+position.lng()+'&sys=dms&datum=not_recorded&source=gazetteer',
      			  success: function(data) {
      			    //alert(data.radius);
      			    var point = new google.maps.LatLng(data.point.latitude, data.point.longitude);
      			    var opts = {
      			        center : point,
      			        radius : data.radius,
      			        fillColor: '#CEE3F6',
      			        strokeWeight: 1
      			    };
      			    var circle = circle = new google.maps.Circle(opts);
      			    //opts.center = new google.maps.LatLng(data.point.latitude, data.point.longitude);
      			    //opts.radius = data.radius;
      			    circle.setMap(app.map);
      			    app.map.setZoom(12);
      			    app.map.setCenter(point);      			
      			    //app.map.setCenter(circle);
      			  }
      			});
    		  	$('json_results').innerHTML = JSON.stringify(results);
      			
    		} else {
      			alert("Geocode was not successful for the following reason: " + status);
    		}
  		});
	}

	app.init = function() {
		var queryPlaceholder = "Berkeley, CA",			
    		latlng = new google.maps.LatLng(37, -121);
    		myOptions = {
      			zoom: 8,
      			center: latlng,
      			mapTypeId: google.maps.MapTypeId.TERRAIN
    		};
    		
    	app.geocoder = geocoder = new google.maps.Geocoder();
    	app.map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);
    	
    	$('button').addEventListener('click', app.handleOnClick, false);
    	$('location').setAttribute('placeholder', queryPlaceholder);
		$('location').addEventListener('keyup', function(evt) {
  		if (evt.keyCode === 13) {
    		$('button').click();
 	 	}
		}, false);
	}
  	
	app.init();
	
--></script> 
</body> 
</html> 